<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
		<title>亦歌 popup page</title>
		
		<style type="text/css">
			body {margin:0; padding:0; width:250px; }
			#navbar {height: 16px; padding:6px; color:#000; font-size:10px; position:relative;}
			a.link {color: #6688dd; font-size:10px; }
			#onBtn, #offBtn {color: #980010; font-size:10px; display:block; position:absolute; right:6px; top:6px; display:none;}
			.hr {height:3px; border-bottom:1px solid #eee; margin-bottom:6px;}
			#fr-bar {display:none;}
			#detail {padding: 0 6px; font-size:10px; height:25px; color:#000;}
		</style>
	</head>
	<body>
		<div id="navbar">
			<a href="http://www.1g1g.com" target="_blank" class="link">在页面中打开</a>
			|
			<a href="javascript:reload();" class="link">刷新</a>
			
			<a href="javascript:on();" id="onBtn">开启(on)</a>
			<a href="javascript:off();" id="offBtn">关闭(off)</a>
		</div>
		<!--
		<div class="hr"></div>
		-->
		<iframe id="fr-bar" src="http://public.1g1g.com/musicbar/circle-button/example.html" frameborder="0" width="250" height="35"></iframe>
		<div id="detail"></div>
		
		<script type="text/javascript">
			var bg = chrome.extension.getBackgroundPage();
			
			// toggle
			var onButton = document.getElementById('onBtn'),
				offButton = document.getElementById('offBtn');
				
			// 
			var frBar = document.getElementById('fr-bar'),
				detail = document.getElementById('detail');
			
			var LOADING_MSG = '加载数据中，请稍候...',
				LOAD_FAILURE_MSG = '加载错误，请点击"刷新"重试!',
				OFF_MSG = '请点击"开启(on)"或者在页面中打开亦歌收听音乐';
			
			bg.addLoadedListener(function(e){
				if (e.state == 'success') {
					detail.innerText = '';
					detail.style.display = 'none';
					frBar.style.display = 'block';
				}
				else {
					detail.innerText = LOAD_FAILURE_MSG;
					detail.style.display = 'block';
				}
			});
			
			initState();
			
			function initState(){
				if (bg.operation) {
					onButton.style.display = 'none';
					offButton.style.display = 'block';
					if (bg.loadSuccess === true || bg.inBackground == false) {
						frBar.style.display = 'block';
						detail.style.display = 'none';
					}
					else 
						if (bg.loadSuccess === false) {
							detail.style.display = 'block';
							detail.innerText = LOAD_FAILURE_MSG;
						}
						else {
							detail.style.display = 'block';
							detail.innerText = LOADING_MSG;
						}
				}
				else {
					frBar.style.display = 'none';
					offButton.style.display = 'none';
					onButton.style.display = 'block';
					detail.style.display = 'block';
					detail.innerText = OFF_MSG;
				}
			}
			
			
			function on(){
				bg.on();
				initState();
			}	
			
			function off(){
				bg.off();
				initState();
			}
			
			function reload(){
				if (bg.operation) {
					
					if (bg.inBackground) {
						detail.style.display = 'block';
						detail.innerText = LOADING_MSG;
						frBar.style.display = 'none';
					}
					bg.reload();
				//
				}
			}
		</script>
	</body>
</html>
